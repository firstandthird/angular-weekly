/*!
 * angular-weekly - Weekly Calendar Angular directive
 * v0.0.14
 * https://github.com/jgallen23/angular-weekly/
 * copyright Greg Allen 2013
 * MIT License
*/
!function(a){a.fn.fitText=function(b,c){var d=b||1,e=a.extend({minFontSize:Number.NEGATIVE_INFINITY,maxFontSize:Number.POSITIVE_INFINITY},c);return this.each(function(){var b=a(this),c=function(){b.css("font-size",Math.max(Math.min(b.width()/(10*d),parseFloat(e.maxFontSize)),parseFloat(e.minFontSize)))};c(),a(window).on("resize.fittext orientationchange.fittext",c)})}}(jQuery),function(a,b){var c=0,d=function(a){this.obj=a};d.prototype.__init=function(a){b.extend(this,this.obj),this.id=c++,this.obj.defaults=this.obj.defaults||{},b.extend(this,this.obj.defaults,a),b("body").trigger("FidelPreInit",this),this.setElement(this.el||b("<div/>")),this.init&&this.init(),b("body").trigger("FidelPostInit",this)},d.prototype.eventSplitter=/^(\w+)\s*(.*)$/,d.prototype.setElement=function(a){this.el=a,this.getElements(),this.delegateEvents(),this.dataElements(),this.delegateActions()},d.prototype.find=function(a){return this.el.find(a)},d.prototype.proxy=function(a){return b.proxy(a,this)},d.prototype.getElements=function(){if(this.elements)for(var a in this.elements){var b=this.elements[a];this[b]=this.find(a)}},d.prototype.dataElements=function(){var a=this;this.find("[data-element]").each(function(c,d){var e=b(d),f=e.data("element");a[f]=e})},d.prototype.delegateEvents=function(){if(this.events)for(var a in this.events){var b=this.events[a],c=a.match(this.eventSplitter),d=c[1],e=c[2],f=this.proxy(this[b]);""===e?this.el.on(d,f):this[e]&&"function"!=typeof this[e]?this[e].on(d,f):this.el.on(d,e,f)}},d.prototype.delegateActions=function(){var a=this;a.el.on("click","[data-action]",function(c){var d=b(this),e=d.attr("data-action");a[e]&&a[e](c,d)})},d.prototype.on=function(a,b){this.el.on(a+".fidel"+this.id,b)},d.prototype.one=function(a,b){this.el.one(a+".fidel"+this.id,b)},d.prototype.emit=function(a,b,c){var d=c?".fidel"+this.id:"";this.el.trigger(a+d,b)},d.prototype.hide=function(){if(this.views)for(var a in this.views)this.views[a].hide();this.el.hide()},d.prototype.show=function(){if(this.views)for(var a in this.views)this.views[a].show();this.el.show()},d.prototype.destroy=function(){this.el.empty(),this.emit("destroy"),this.el.unbind(".fidel"+this.id)},d.declare=function(a){var b=function(a,b){this.__init(a,b)};return b.prototype=new d(a),b},d.onPreInit=function(a){b("body").on("FidelPreInit",function(b,c){a.call(c)})},d.onPostInit=function(a){b("body").on("FidelPostInit",function(b,c){a.call(c)})},a.Fidel=d}(window,window.jQuery||window.Zepto),function(a){a.declare=function(b,c){a.fn[b]=function(){var d,e,f=Array.prototype.slice.call(arguments),g=f.shift();return e=this.each(function(){var e=a(this),h=e.data(b);if(!h){var i=Fidel.declare(c),j=a.extend({},g,{el:e});h=new i(j),e.data(b,h)}"string"==typeof g&&(d=h[g].apply(h,f))}),"undefined"!=typeof d?d:e},a.fn[b].defaults=c.defaults||{}},a.Fidel=window.Fidel}(jQuery),function(a){var b=a.template,c={};opts={openTag:"<%",closeTag:"%>"};var d=function e(a,b){var d=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split(opts.openTag).join("	").replace(new RegExp("((^|"+opts.closeTag+")[^	]*)'","g"),"$1\r").replace(new RegExp("	=(.*?)"+opts.closeTag,"g"),"',$1,'").split("	").join("');").split(opts.closeTag).join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):c[a]=c[a]||e(a);return b?d(b):d};d.options=opts,d.noConflict=function(){return a.template=b,d},a.template=d}(window),function(a){a.template=template.noConflict(),a.prototype.render=function(b){var c=this.template?this.template:$("#"+this.templateId).html();this.el.html(a.template(c,b))}}(window.Fidel),function(a){var b=a.dateUtils,c={noConflict:function(){return a.dateUtils=b,c},getFirstDayOfWeek:function(a,b){b=b||0;var c=a.getDate()-a.getDay(),d=new Date(a.getTime());return d.setDate(c+7*b),d},getLastDayOfWeek:function(a,b){b=b||0;var c=a.getDate()-a.getDay(),d=new Date(a.getTime());return d.setDate(c+6+7*b),d},getDates:function(a,b,c){a=new Date(a),a.setHours(0,0,0),c=c||0;for(var d=7,e=[],f=this.getFirstDayOfWeek(a,b),g=0,h=d;h>g;g++){var i=new Date(f.getTime());i.setDate(i.getDate()-i.getDay()+c+g),e.push(i)}return e},getTimes:function(a,b){for(var c=b+12,d=[],e=a;c>e;e++){var f=e>12||0===e?Math.abs(e-12):e,g=f+":00 ";g+=e>11?"PM":"AM",d.push(g)}return d},getWeekSpan:function(a,b,c){c=c||0;var d=this.getFirstDayOfWeek(a,b),e=this.getLastDayOfWeek(a,b);d.setDate(d.getDate()+c),e.setDate(e.getDate()+c);var f=TimeFormat("%M %d",d)+" - ";return f+=d.getMonth()==e.getMonth()?TimeFormat("%d",e):TimeFormat("%M %d",e)},realTimezoneOffset:function(a){var b=(new Date).getTimezoneOffset()/-60,c=a-b;return c},isPastDate:function(a){var b=a.split("-");return TimeFormat("%Y%m%d",new Date(b[0],b[1],b[2]))<TimeFormat("%Y%m%d",new Date)}};a.dateUtils=c}(window),function(a){var b=a.TimeFormat,c="January|February|March|April|May|June|July|August|September|October|November|December".split("|"),d="Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday".split("|"),e=function(a,b){return!b instanceof Date?void 0:a.replace(/%d|%D|%j|%l|%S|%w|%F|%m|%M|%n|%Y|%y|%a|%A|%g|%G|%h|%H|%i|%s|%u|%e/g,function(a){switch(a){case"%d":return("0"+b.getDate()).substr(-2,2);case"%D":return d[b.getDay()].substr(0,3);case"%j":return b.getDate();case"%l":return d[b.getDay()];case"%S":return 1===b.getDate()?"st":2===b.getDate()?"nd":3===b.getDate()?"rd":"th";case"%w":return b.getDay();case"%F":return c[b.getMonth()];case"%m":return("0"+(b.getMonth()+1)).substr(-2,2);case"%M":return c[b.getMonth()].substr(0,3);case"%n":return b.getMonth();case"%Y":return b.getFullYear();case"%y":return b.getFullYear().toString().substr(-2,2);case"%a":return b.getHours()>11?"pm":"am";case"%A":return b.getHours()>11?"PM":"AM";case"%g":return b.getHours()>12?b.getHours()-12:b.getHours()?b.getHours():12;case"%G":return b.getHours();case"%h":return("0"+(b.getHours()>12?b.getHours()-12:b.getHours())).substr(-2,2);case"%H":return("0"+b.getHours()).substr(-2,2);case"%i":return("0"+b.getMinutes()).substr(-2,2);case"%s":return("0"+b.getSeconds()).substr(-2,2);case"%u":return b.getMilliseconds();case"%e":return b.getTimezoneOffset()}})};e.noConflict=function(){return a.TimeFormat=b,e},a.TimeFormat=e}(window),function(a){a.declare("weekly",{defaults:{startTime:0,endTime:12,startTimeScrollOffset:"8:00 AM",weekOffset:0,currentDate:new Date,autoRender:!0,fitText:!0,fitTextMin:12,fitTextMax:15,template:'<div class="weekly-time-navigation">  <% if (showPreviousWeekButton) { %>  <button class="weekly-previous-week weekly-change-week-button" data-action="prevWeek">&laquo; <span class="week"></span></button>  <% } %>  <button class="weekly-next-week weekly-change-week-button" data-action="nextWeek"><span class="week"></span> &raquo;</button>  <button class="weekly-jump-today weekly-change-today-button" data-action="jumpToday">Today</button>  <div class="weekly-header"></div></div><div class="weekly-calendar">  <div class="weekly-days">  <% for (var i = 0; i < dates.length; i++) { var date = dates[i]; %>    <div class="weekly-day" style="width:<%= 100/dates.length %>%" data-date="<%= timef(\'%Y-%n-%j\', date) %>">      <%= timef(\'%D %m/%d\', date) %>    </div>  <% } %>  </div>  <div class="weekly-scroller">    <div class="weekly-times">    <% for (var i = 0; i < times.length; i++) { var time = times[i]; %>      <div class="weekly-time" data-time="<%= time %>"><%= time %></div>    <% } %>    </div>    <div class="weekly-grid">    <% for (var i = 0; i < dates.length; i++) { var date = dates[i]; %>      <div class="weekly-day" style="width:<%= 100/dates.length %>%" data-date="<%= timef(\'%Y-%n-%j\', date) %>">        <% for (var ii = 0; ii < times.length; ii++) { var time = times[ii]; %>          <div class="weekly-time" data-time="<%= time %>">&nbsp;</div>        <% } %>      </div>    <% } %>    </div>  </div></div>',readOnly:!1,enableResize:!0,enableDelete:!0,autoSplit:!1,autoSplitInterval:30,showToday:!0,allowPreviousWeeks:!0,allowPastEventCreation:!1,timezoneOffset:0,utcOffset:(new Date).getTimezoneOffset()/-60,todayFirst:!1,dayOffset:0,interval:30},events:{"click .weekly-event":"eventClicked"},init:function(){if(this.events=[],this.oldDate=this.currentDate,this.readOnly&&(this.enableResize=!1,this.enableDelete=!1),this.todayFirst&&(this.dayOffset=this.currentDate.getDay()),(this.interval<1||this.interval>60)&&(this.interval=60),this.autoRender){var a=this.update();this.emit("weekChange",a)}},get:function(a){return this[a]},update:function(){var b={timef:TimeFormat,getWeekSpan:dateUtils.getWeekSpan,currentDate:this.currentDate,dates:dateUtils.getDates(this.currentDate,this.weekOffset,this.dayOffset),times:dateUtils.getTimes(this.startTime,this.endTime),showPreviousWeekButton:this.allowPreviousWeeks||0!==this.weekOffset};this.render(b);for(var c=0,d=this.events.length;d>c;c++)this.renderEvent(this.events[c]);if(this.timeDifference=this.endTime+12-this.startTime,this.registerClickToCreate(),this.registerModifyEvent(),this.highlightToday(),this.showToday&&this.weekOffset?this.el.find(".weekly-change-today-button").css("display","block"):this.el.find(".weekly-change-today-button").css("display","none"),this.el.find(".weekly-time-navigation .weekly-previous-week .week").html(dateUtils.getWeekSpan(this.currentDate,this.weekOffset-1,this.dayOffset)),this.el.find(".weekly-time-navigation .weekly-next-week .week").html(dateUtils.getWeekSpan(this.currentDate,this.weekOffset+1,this.dayOffset)),this.el.find(".weekly-time-navigation .weekly-header").html(dateUtils.getWeekSpan(this.currentDate,this.weekOffset,this.dayOffset)),this.fitText&&this.el.find(".weekly-days .weekly-day, .weekly-times .weekly-time").fitText(1,{minFontSize:this.fitTextMin,maxFontSize:this.fitTextMax}),this.startTimeScrollOffset){var e=a(window).scrollTop(),f=this.el.find('[data-time="'+this.startTimeScrollOffset+'"]');f[0].scrollIntoView(),a(window).scrollTop(e)}return{dates:b.dates,times:b.times}},highlightToday:function(){var a=this.currentDate;this.el.find('.weekly-grid [data-date="'+TimeFormat("%Y-%n-%j",a)+'"]').addClass("weekly-today")},registerClickToCreate:function(){this.mouseDown=!1,this.pendingEvent=null,this.pendingEventStart=null;var b=this.el.find(".weekly-grid .weekly-day");b.unbind("mousedown mousemove mouseup mouseout click"),this.readOnly||(b.on("mousedown",this.proxy(function(b){var c=a(b.target);if(1===b.which&&!c.is(".weekly-dragger")&&!c.is(".weekly-delete")){var d=a(b.currentTarget);(this.allowPastEventCreation||!dateUtils.isPastDate(d.data("date")))&&(this.mouseDown=!0,this.pendingEvent&&(this.pendingEvent.remove(),this.pendingEvent=null))}})),b.on("mouseup",this.proxy(function(){if(this.mouseDown&&(this.mouseDown=!1,this.pendingEvent)){var a=this.pendingEvent.data(),b=a.date.split("-");this.addEvent({start:new Date(b[0],b[1],b[2],~~a.starttime-this.timezoneOffset,this.fromDecimal(a.starttime)),end:new Date(b[0],b[1],b[2],~~a.endtime-this.timezoneOffset,this.fromDecimal(a.endtime))}),this.pendingEvent.remove(),this.pendingEvent=null,this.pendingEventStart=null}})),b.on("mousemove",this.proxy(function(a){this.mouseDown&&this.createEvent(a)})),b.on("click",this.proxy(function(c){var d=a(c.currentTarget);(this.allowPastEventCreation||!dateUtils.isPastDate(d.data("date")))&&a(c.target).is(".weekly-time,.weekly-day")&&(this.mouseDown=!0,this.createEvent(c),b.trigger("mouseup"))})),b.on("mouseleave",this.proxy(function(){this.mouseDown&&b.trigger("mouseup")})))},registerModifyEvent:function(){this.mouseModifyDown=!1;var b=this.el.find(".weekly-grid");this.currentDragger=null,b.find(".weekly-dragger").unbind("mousedown mousemove mouseup mouseout click"),this.readOnly||(b.on("mousedown",".weekly-dragger",this.proxy(function(b){1===b.which&&(this.mouseModifyDown=!0,this.currentDragger=a(b.target),this.eventOffset=0)})),b.on("mouseup",".weekly-day",this.proxy(function(){this.mouseModifyDown=!1,this.currentDragger=null})),b.on("mousemove",".weekly-day",this.proxy(function(a){this.mouseModifyDown&&this.modifyEvent(a)})),b.on("mouseleave",this.proxy(function(){this.mouseModifyDown&&this.currentDragger.trigger("mouseup")})))},createEvent:function(b){var c=a(b.currentTarget),d=c.parent().offset(),e=b.pageY-d.top,f=a(b.currentTarget).height(),g=Math.round(f/this.timeDifference),h=g/(60/this.interval),i=Math.floor(e/h)*h,j=Math.ceil(e/h)*h;null===this.pendingEventStart&&(this.pendingEventStart=i),(null===this.pendingEventEnd||j>this.pendingEventStart)&&(this.pendingEventEnd=j),this.pendingEvent||(c.append('<div class="weekly-event-pending"></div>'),this.pendingEvent=c.find(".weekly-event-pending"),this.pendingEvent.data("date",c.data("date"))),this.pendingEvent.css({top:this.pendingEventStart,bottom:f-this.pendingEventEnd}),this.pendingEvent.data("starttime",(this.pendingEventStart/g||0)+this.startTime),this.pendingEvent.data("endtime",(this.pendingEventEnd/g||1)+this.startTime)},modifyEvent:function(b){var c=this.currentDragger.parents(".weekly-event"),d=c.parent().offset(),e=b.pageY-d.top,f=a(b.currentTarget).height(),g=Math.round(f/this.timeDifference),h=g/(60/this.interval),i=Math.ceil(e/h)*h;i<d.top+f&&c.css({bottom:f-i});var j=c.outerHeight()/g,k=new Date(c.data("start"));k.setHours(k.getHours()+~~j),k.setMinutes(this.fromDecimal(j)),c.data("end",k),this.events[c.data("_index")].end=k,this.el.trigger("modifyEvent",this.events[c.data("_index")])},nextWeek:function(){this.changeDate(1)},prevWeek:function(){this.changeDate(-1)},jumpToday:function(){this.changeDate(0)},changeDate:function(a){a?this.weekOffset+=a:this.weekOffset=0;var b=this.update();this.emit("weekChange",b)},renderEvent:function(b){var c=new Date(b.start.getTime()),d=new Date(b.end.getTime());c.setHours(c.getHours()+this.timezoneOffset),d.setHours(d.getHours()+this.timezoneOffset);var e=c.getFullYear()+"-"+c.getMonth()+"-"+c.getDate(),f=c.toTimeString().slice(0,5);d.getFullYear()+"-"+b.end.getMonth()+"-"+d.getDate();var g=d.toTimeString().slice(0,5);"00:00"===g&&(g="24:00");var h=100-this.getTimeOffsetPercent(f),i=this.getTimeOffsetPercent(g),j=a('<div class="weekly-event"></div>');j.data(b),j.data("offset-start",c),j.data("offset-end",d),j.css({top:h+"%",bottom:i+"%"}).append(['<button data-action="removeEvent" class="weekly-delete">&times;</button>','<div class="weekly-event-time">'+TimeFormat("%g:%i",c)+" - "+TimeFormat("%g:%i%a",d)+"</div>",'<div class="weekly-event-title">'+b.title+"</div>",'<div class="weekly-event-desc">'+b.description+"</div>",'<div class="weekly-dragger"></div>'].join("")),this.enableResize||j.find(".weekly-dragger").remove(),this.enableDelete||j.find(".weekly-delete").remove(),b.type&&j.addClass("weekly-event-"+b.type.replace(/ /g,"-"));var k=this.el.find('.weekly-grid .weekly-day[data-date="'+e+'"]');k.append(j),this.fitText&&k.find(".weekly-event-title").fitText(1,{minFontSize:this.fitTextMin,maxFontSize:this.fitTextMax})},toFraction:function(a){if(-1===a.toString().indexOf(":"))return a;var b=a.toString().split(":");return parseFloat(b[0]+"."+100/(60/b[1]))},fromDecimal:function(a){return Math.round(60*(a%1))},getTimeOffsetPercent:function(a){a=this.toFraction(a)-this.startTime;var b=this.timeDifference-a;0>b&&(b=a-this.timeDifference);var c=100*(b/this.timeDifference);return c},setAutoSplit:function(a){this.autoSplit=a},setSplitInterval:function(a){this.autoSplitInterval=a},splitEvent:function(b){for(var c=b.end.getTime()-b.start.getTime(),d=1e3*60*this.autoSplitInterval,e=Math.ceil(c/d),f=b.start.getTime(),g=[],h=0;e>h;h++){var i=a.extend({},b);i.start=new Date(f+d*h),i.end=new Date(f+d*(h+1)),g.push(i)}return g},addEvent:function(b){if(b instanceof Array)for(var c=0,d=b.length;d>c;c++)this.addEvent(b[c]);else{b=this.autoSplit?this.splitEvent(b):[b];for(var e=0,f=b.length;f>e;e++){var g=b[e];g=a.extend({title:"",description:"",start:null,end:null},g),g._index=this.events.length,g.start.getHours()>=this.startTime&&g.end.getHours()<=this.endTime+12&&this.renderEvent(g),this.events.push(g)}var h=this.autoSplit?b:b[0];this.emit("addEvent",[h])}},removeEvent:function(b){var c=a(b.target).parents(".weekly-event"),d=c.data();return this.events.splice(d._index,1),c.remove(),this.el.trigger("removeEvent",d),!1},clearEvents:function(){this.el.find(".weekly-event").remove(),this.events=[],this.el.trigger("clearEvents")},eventClicked:function(b){var c=a(b.currentTarget),d=c.data();this.emit("eventClick",[d,c])},setTimezoneOffset:function(a){return this.timezoneOffset=dateUtils.realTimezoneOffset(a),this.utcOffset=a,this.update(),this},setReadOnly:function(a){return this.readOnly=a,this.enableResize=!a,this.enableDelete=!a,this.update(),this}})}(jQuery),function(){angular.module("weekly",[]).directive("weekly",["$parse",function(){return{restrict:"EA",require:"ngModel",scope:{model:"=ngModel",options:"&weekly",weekChangeEventFn:"&weeklyChange",addEventFn:"&weeklyAdd",removeEventFn:"&weeklyRemove",clickEventFn:"&weeklyClick",timezone:"=weeklyTimezone",splitInterval:"=weeklySplitInterval",readOnly:"=weeklyReadonly"},link:function(a,b,c){var d=!1,e=a.options();b.addClass("weekly").on("weekChange",function(b,c){a.weekChangeEventFn({data:c})}).on("addEvent",function(b,c){d||a.$apply(function(){c=c instanceof Array?c:[c];for(var b=0,d=c.length;d>b;b++){var e=c[b];a.model.push(e)}a.addEventFn({event:c})})}).on("removeEvent",function(b,c){if(!d){var e=c._index;a.$apply(function(){a.model.splice(e,1),a.removeEventFn({event:c})})}}).on("eventClick",function(b,c,d){a.$apply(function(){a.clickEventFn({event:a.model[c._index],el:d})})}).weekly(e),c.ngModel&&a.$watch("model",function(a){d=!0,b.weekly("clearEvents").weekly("addEvent",a),d=!1},!0),c.weeklyTimezone&&a.$watch("timezone",function(a){a&&b.weekly("setTimezoneOffset",a)}),c.weeklySplitInterval&&a.$watch("splitInterval",function(a){a&&b.weekly("setSplitInterval",a)}),c.weeklyReadonly&&a.$watch("readOnly",function(a){"undefined"!=typeof a&&b.weekly("setReadOnly",a)})}}}])}();